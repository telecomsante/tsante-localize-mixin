<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../app-localize-behavior/app-localize-behavior.html">
<script>
/**
* `TSPolymer.TsanteLocalizeMixin` wraps the Polymer.AppLocalizeBehavior.
* It simplifies the loading of json locale resources.
* In the folder of your create a folder 'lang' and add the json locale files in it : 
* - lang/
* - lang/fr.json
* - lang/en.json
* - lang/de.json
* The behavior will automatically get those files according to its locale array content.
* The default locales loaded are fr, en, de, it, es. If a file is not found no worries, it won't fail, but you may have a few error messages in the console.
*     <dom-module id="x-app">
*        <template>
*         <div>{{localize('hello', 'name', 'Batman')}}</div>
*        </template>
*        <script>
*           Polymer({
*             is: "x-app",
*             behaviors: [ TSPolymerBehaviors.TsanteLocalizeBehavior ],
*             properties: {
*               language: {
*                 value: 'en'
*               },
*             }
*           });
*        &lt;/script>
*     </dom-module>
*
* @demo demo/index.html
* @polymerBehavior Tsante.TsanteLocalizeBehavior
*/
const TsanteLocalizeBehaviorImpl = {
  properties: {
    locales: {
      type: Array,
      value: ['fr', 'en', 'de', 'es', 'it']
    },
    _folder: { type: String, value: 'lang' },
    _extension: { type: String, value: 'json' },
    _prefix: { type: String, value: '' },
    _suffix: { type: String, value: '' }
  },
  attached: async function(){
    const fetches = this.locales.map(locale => fetch(this.resolveUrl(`${this._folder}/${this._prefix}${locale}${this._suffix}.${this._extension}`)))
    const results = await Promise.all(fetches)
    const correct = results.filter(result => result.status === 200)
    const jsons = await Promise.all(correct.map(e => e.json()))
    const json = Object.assign({}, ...jsons)
    this.resources = json
  }
}
window.TSPolymer = window.TSPolymer || {}
window.TSPolymerBehaviors.TsanteLocalizeBehavior =  [ Polymer.AppLocalizeBehavior, TsanteLocalizeBehaviorImpl]
</script>